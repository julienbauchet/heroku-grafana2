/*! grafana - v4.0.0-1478693311beta1 - 2016-11-09
 * Copyright (c) 2016 Torkel Ã–degaard; Licensed Apache-2.0 */

System.register(["app/core/config","lodash","../dynamic_dashboard_srv"],function(a){var b,c,d,e;return{setters:[function(a){b=a},function(a){c=a},function(a){d=a}],execute:function(){e=function(){function a(a){this.datasourceSrv=a}return a.prototype.makeExportable=function(a){var e=this,f=new d.DynamicDashboardSrv;f.init(a,{variables:a.templating.list}),f.process({cleanUpOnly:!0}),a.id=null;for(var g=[],h={},i={},j=[],k=function(a){j.push(e.datasourceSrv.get(a.datasource).then(function(b){if(!b.meta.builtIn){var c="DS_"+b.name.replace(" ","_").toUpperCase();i[c]={name:c,label:b.name,description:"",type:"datasource",pluginId:b.meta.id,pluginName:b.meta.name},a.datasource="${"+c+"}",h["datasource"+b.meta.id]={type:"datasource",id:b.meta.id,name:b.meta.name,version:b.meta.info.version||"1.0.0"}}}))},l=0,m=a.rows;l<m.length;l++)for(var n=m[l],o=0,p=n.panels;o<p.length;o++){var q=p[o];if(void 0!==q.datasource&&k(q),q.targets)for(var r=0,s=q.targets;r<s.length;r++){var t=s[r];void 0!==t.datasource&&k(t)}var u=b["default"].panels[q.type];u&&(h["panel"+u.id]={type:"panel",id:u.id,name:u.name,version:u.info.version})}for(var v=0,w=a.templating.list;v<w.length;v++){var x=w[v];"query"===x.type&&(k(x),x.options=[],x.current={},x.refresh=1)}for(var y=0,z=a.annotations.list;y<z.length;y++){var A=z[y];k(A)}return h.grafana={type:"grafana",id:"grafana",name:"Grafana",version:b["default"].buildInfo.version},Promise.all(j).then(function(){c["default"].each(i,function(a,b){g.push(a)});for(var b=0,d=a.templating.list;b<d.length;b++){var e=d[b];if("constant"===e.type){var f="VAR_"+e.name.replace(" ","_").toUpperCase();g.push({name:f,type:"constant",label:e.label||e.name,value:e.current.value,description:""}),e.query="${"+f+"}",e.options[0]=e.current={value:e.query,text:e.query}}}h=c["default"].map(h,function(a){return a});var j={};return j.__inputs=g,j.__requires=h,c["default"].defaults(j,a),j})["catch"](function(a){return console.log("Export failed:",a),{error:a}})},a}(),a("DashboardExporter",e)}}});